1
00:00:00,500 --> 00:00:03,000
现在 你能在手机上接收到来自我的应用服务器

2
00:00:03,000 --> 00:00:04,530
的消息

3
00:00:04,530 --> 00:00:06,132
这挺不错的

4
00:00:06,131 --> 00:00:07,589
但是目前的方式

5
00:00:07,589 --> 00:00:09,118
有一个不足之处

6
00:00:09,118 --> 00:00:12,359
那就是它只能向一名用户发送消息

7
00:00:12,359 --> 00:00:14,278
我们希望能让讲师接触到全球的用户

8
00:00:14,278 --> 00:00:17,039
向关注者发送重要的生活动态

9
00:00:17,039 --> 00:00:19,939
所以不能只是发送到一部手机

10
00:00:19,940 --> 00:00:21,690
幸运的是 我们使用 FCM 可以通过几种方式

11
00:00:21,690 --> 00:00:23,940
将数据发送到多部手机

12
00:00:23,940 --> 00:00:25,859
向群组发送数据的两种途径包括

13
00:00:25,859 --> 00:00:29,230
使用设备组和话题

14
00:00:29,230 --> 00:00:31,830
来看看第一个选项 设备组

15
00:00:31,829 --> 00:00:34,109
设备组通常是属于同一个用户

16
00:00:34,109 --> 00:00:36,118
的一组设备

17
00:00:36,118 --> 00:00:39,469
例如 如果 Jessica 有两部手机和一部平板电脑

18
00:00:39,469 --> 00:00:42,359
它们都使用 Squawker 我们可以将所有这些设备

19
00:00:42,359 --> 00:00:44,850
存储在一个设备组中

20
00:00:44,850 --> 00:00:47,039
这些设备组的管理的创建

21
00:00:47,039 --> 00:00:50,234
都在应用服务器的服务器端完成

22
00:00:50,234 --> 00:00:51,899
而 Squawker 服务器实际上

23
00:00:51,899 --> 00:00:54,118
对设备组不发挥任何作用 所以

24
00:00:54,118 --> 00:00:55,787
不在本课范围之内

25
00:00:55,789 --> 00:00:58,079
不过我在笔记中链接了一些额外信息

26
00:00:58,079 --> 00:00:59,868
感兴趣的可以查看一下

27
00:00:59,868 --> 00:01:02,399
好的 接下来是话题这个概念

28
00:01:02,399 --> 00:01:04,709
话题有点像邮寄清单

29
00:01:04,709 --> 00:01:07,650
一些客户端设备会选择订阅某个话题

30
00:01:07,650 --> 00:01:10,080
然后当这个话题发送一条消息时 

31
00:01:10,078 --> 00:01:13,408
仅订阅的设备将收到消息

32
00:01:13,409 --> 00:01:15,890
那么这在代码中实际是什么样的呢？

33
00:01:15,890 --> 00:01:18,030
在服务器端 你并非将消息发送到

34
00:01:18,030 --> 00:01:22,829
特定 ID 而是发送到特定话题

35
00:01:22,828 --> 00:01:25,919
一个话题用一个字符串键表示

36
00:01:25,920 --> 00:01:28,980
例如 我们可以使用键 currentEvents

37
00:01:28,980 --> 00:01:30,480
注意 话题键将始终

38
00:01:30,480 --> 00:01:34,060
跟在前后用正斜杠分隔的单词 topics 之后 

39
00:01:34,060 --> 00:01:37,230
客户端设备可以使用此键订阅和取消订阅

40
00:01:37,230 --> 00:01:38,969
话题

41
00:01:38,968 --> 00:01:41,309
例如 使用 currentEvents 键

42
00:01:41,310 --> 00:01:43,980
订阅到这个话题的设备将获得发送到该话题

43
00:01:43,980 --> 00:01:45,000
的所有消息

44
00:01:45,000 --> 00:01:47,250
我们来通过一个更完整的例子

45
00:01:47,250 --> 00:01:48,819
看看它的运作原理

46
00:01:48,819 --> 00:01:51,228
假如说你有一个用于观看奥林匹克运动会的应用

47
00:01:51,230 --> 00:01:53,170
用户选择了最喜爱的国家

48
00:01:53,170 --> 00:01:55,469
然后每当用户最喜爱国家的一名选手

49
00:01:55,468 --> 00:01:58,938
获奖时 用户手机上就会收到通知

50
00:01:58,938 --> 00:02:02,188
确定国家的一个方式是给每个国家一个话题

51
00:02:02,188 --> 00:02:05,369
例如 这些可以作为话题键

52
00:02:05,370 --> 00:02:08,158
在客户端方面 你可以写下这样的代码

53
00:02:08,158 --> 00:02:10,798
来通过 onClickListener 中的这些按钮中的一个

54
00:02:10,800 --> 00:02:12,219
订阅话题

55
00:02:12,218 --> 00:02:14,608
例如 按下这个按钮会

56
00:02:14,610 --> 00:02:16,320
订阅“日本”话题

57
00:02:16,318 --> 00:02:18,560
按下这个按钮会

58
00:02:18,560 --> 00:02:20,188
订阅“美国”话题

59
00:02:20,188 --> 00:02:23,340
同样 你也可以添加一个取消订阅按钮

60
00:02:23,340 --> 00:02:26,069
并从话题方法中使用取消订阅

61
00:02:26,068 --> 00:02:28,018
然后 当一个国家赢得奖牌后

62
00:02:28,020 --> 00:02:30,900
你的应用的服务器会向 FCM 发送一条消息

63
00:02:30,900 --> 00:02:34,140
注意 这里我们用的不是设备注册 ID 令牌

64
00:02:34,139 --> 00:02:36,509
而是 topics 后跟话题名称

65
00:02:36,508 --> 00:02:38,063
在这个例子中是 Japan

66
00:02:38,063 --> 00:02:41,098
这会将相关的数据或通知消息

67
00:02:41,098 --> 00:02:43,198
发送给注册到日本话题的

68
00:02:43,199 --> 00:02:45,719
所有客户端设备

69
00:02:45,718 --> 00:02:48,538
在这个情况下 FCM 消息是一条通知消息

70
00:02:48,538 --> 00:02:51,448
那么就会显示这样一条通知

71
00:02:51,449 --> 00:02:53,368
好的 需要注意的非常重要的一点是

72
00:02:53,370 --> 00:02:56,099
你订阅的键

73
00:02:56,098 --> 00:02:58,530
和服务器发送消息的接收键

74
00:02:58,530 --> 00:03:00,870
必须完全匹配

75
00:03:00,870 --> 00:03:03,670
你应该也看到了 话题的设置非常简单

76
00:03:03,669 --> 00:03:05,459
并不需要很多代码

77
00:03:05,460 --> 00:03:07,820
现在利用所学的关于话题的知识 你能

78
00:03:07,818 --> 00:03:10,068
自己在 Squawker 中使用它们了吗？

