1
00:00:00,390 --> 00:00:02,515
你现在知道如何手动将一条

2
00:00:02,515 --> 00:00:04,379
通知消息发送给一堆手机

3
00:00:04,378 --> 00:00:06,660
或一部手机

4
00:00:06,660 --> 00:00:08,849
你甚至可以附加一些额外的数据

5
00:00:08,849 --> 00:00:10,559
以便用户打开应用时

6
00:00:10,560 --> 00:00:13,980
会知道应用是从 FCM 消息服务打开的

7
00:00:13,980 --> 00:00:15,060
这挺酷的

8
00:00:15,060 --> 00:00:18,280
但这并非我们想要的 Squawker 的用例

9
00:00:18,280 --> 00:00:21,750
对于 Squawker 我们需要将手动操作减到最少

10
00:00:21,750 --> 00:00:24,088
我们不可能让人员进入 Firebase 控制台

11
00:00:24,088 --> 00:00:25,939
去发送 squawk

12
00:00:25,940 --> 00:00:28,050
我们想要的是比如构建一个网站

13
00:00:28,050 --> 00:00:31,170
使讲师可以在上面发送 squawk

14
00:00:31,170 --> 00:00:34,079
假设我们有这样一个网站 讲师

15
00:00:34,079 --> 00:00:35,820
可以在上面发送 squawk

16
00:00:35,820 --> 00:00:38,640
无论讲师在何时何地输入一条 squawk

17
00:00:38,640 --> 00:00:40,410
它都会触发 FCM 服务器通过消息

18
00:00:40,408 --> 00:00:42,988
更新所有当前的客户端应用

19
00:00:42,990 --> 00:00:45,570
FCM 在设计时已考虑了这一点

20
00:00:45,570 --> 00:00:48,719
那么我们实际上可以设计像这样的 squawk 服务器

21
00:00:48,719 --> 00:00:50,850
并且有些协议和库可以让你将消息

22
00:00:50,850 --> 00:00:52,590
从所构建的网站发送到

23
00:00:52,590 --> 00:00:56,287
Google 控制的 FCM 服务器

24
00:00:56,286 --> 00:00:58,618
FCM 会正常地将这些消息发送到你的

25
00:00:58,618 --> 00:01:00,149
Android 应用

26
00:01:00,149 --> 00:01:02,338
因为这节课并不是关于网页设计

27
00:01:02,340 --> 00:01:05,189
我已为你构建了一个很棒的服务器

28
00:01:05,188 --> 00:01:08,038
它是一个用于测试目的的原型

29
00:01:08,040 --> 00:01:09,630
共有两个选项

30
00:01:09,629 --> 00:01:12,989
你可以直接向单个设备发送 squawk

31
00:01:12,989 --> 00:01:15,239
也可以发送来自五位讲师中的一位

32
00:01:15,239 --> 00:01:16,920
的虚拟消息

33
00:01:16,920 --> 00:01:19,170
注意向单个设备发送的选项

34
00:01:19,170 --> 00:01:21,900
要使用手机 ID 令牌

35
00:01:21,900 --> 00:01:25,109
你还需要一个叫作服务器密钥的东西

36
00:01:25,108 --> 00:01:27,298
服务器密钥有点难找

37
00:01:27,299 --> 00:01:30,149
回到“概述”(Overview) 它看起来是这样的

38
00:01:30,150 --> 00:01:32,480
然后转置“设置”(settings)

39
00:01:32,480 --> 00:01:35,670
在设置中 你将看到一个叫作“云消息传递”(Cloud Messaging) 的选项卡

40
00:01:35,670 --> 00:01:39,189
你可以在此复制此旧服务器密钥

41
00:01:39,188 --> 00:01:41,008
现在回到我的 Squawker 服务器

42
00:01:41,010 --> 00:01:45,330
我可以将服务器密匙和

43
00:01:45,328 --> 00:01:47,848
最近获得的 FCM 令牌粘贴到这里

44
00:01:47,849 --> 00:01:50,969
然后我发送一条 squawk

45
00:01:50,968 --> 00:01:53,218
我得到了这些整洁的 JSON 代码

46
00:01:53,218 --> 00:01:56,608
但是没看到任何消息

47
00:01:56,608 --> 00:01:58,348
这实际上并没有成功

48
00:01:58,349 --> 00:01:59,731
为什么呢？

49
00:01:59,730 --> 00:02:01,438
如我之前提到的 当 Firebase 控制台

50
00:02:01,438 --> 00:02:03,389
向 FCM 服务器发送消息时

51
00:02:03,390 --> 00:02:06,030
它会发送所谓的通知消息

52
00:02:06,030 --> 00:02:07,545
就像这样

53
00:02:07,545 --> 00:02:10,408
这是客户端手机上的额外好处

54
00:02:10,408 --> 00:02:12,500
它会显示通知

55
00:02:12,500 --> 00:02:15,038
FCM 还有另一种类型的消息 你可以在此看到

56
00:02:15,038 --> 00:02:17,250
叫作数据消息

57
00:02:17,250 --> 00:02:19,014
数据消息看起来是这样的

58
00:02:19,014 --> 00:02:21,180
主要区别就在于这里不是“通知”

59
00:02:21,180 --> 00:02:23,968
而是“数据”

60
00:02:23,968 --> 00:02:26,128
你的应用将根据发送的是通知消息

61
00:02:26,128 --> 00:02:28,888
还是数据消息 做出不同的

62
00:02:28,889 --> 00:02:30,058
反应

63
00:02:30,060 --> 00:02:32,340
只要应用在后台运行

64
00:02:32,340 --> 00:02:34,590
通知消息就会显示一条消息

65
00:02:34,590 --> 00:02:39,050
它们具有预定义的键值对 就像你在这里

66
00:02:39,050 --> 00:02:41,939
看到的 body 键和值“Hello World”

67
00:02:41,938 --> 00:02:45,538
这控制了你的通知的正文内容

68
00:02:45,538 --> 00:02:47,488
你也可以在 intent extra 包中

69
00:02:47,490 --> 00:02:50,909
包含可选的键值对 以在

70
00:02:50,908 --> 00:02:53,698
从通知中启用应用时访问

71
00:02:53,699 --> 00:02:55,859
在这个示例中 test 就是

72
00:02:55,860 --> 00:02:58,140
这些额外键值对的一个示例

73
00:02:58,139 --> 00:02:59,879
另外 通知消息也可以 

74
00:02:59,878 --> 00:03:01,679
从 Firebase 控制台发送

75
00:03:01,680 --> 00:03:04,020
相比之下 数据消息不会

76
00:03:04,020 --> 00:03:06,060
自动执行任何操作

77
00:03:06,060 --> 00:03:07,650
这意味着由你负责

78
00:03:07,650 --> 00:03:10,020
添加代码来处理

79
00:03:10,020 --> 00:03:11,802
进入的数据

80
00:03:11,800 --> 00:03:14,008
它不会自动显示通知或任何

81
00:03:14,008 --> 00:03:15,750
类似的信息

82
00:03:15,750 --> 00:03:18,210
由于数据消息几乎可以做任何事

83
00:03:18,210 --> 00:03:19,890
它们有你想要传递的

84
00:03:19,889 --> 00:03:22,266
任何自定义键值对

85
00:03:22,265 --> 00:03:24,598
在这个例子中 你可以看到其中一些自定义

86
00:03:24,598 --> 00:03:25,655
键值对

87
00:03:25,657 --> 00:03:27,240
它们看起来很像你在单条 squawk 中

88
00:03:27,240 --> 00:03:29,189
所需的数据

89
00:03:29,188 --> 00:03:31,680
请注意到目前为止 数据消息无法

90
00:03:31,680 --> 00:03:34,530
从 Firebase 控制台发送 这意味着你得自己

91
00:03:34,530 --> 00:03:37,169
编写服务器来发送数据

92
00:03:37,169 --> 00:03:38,118
消息

93
00:03:38,120 --> 00:03:39,870
随着我们更多地探索数据消息

94
00:03:39,870 --> 00:03:41,819
与通知消息 我会

95
00:03:41,818 --> 00:03:45,149
在这个列表中添加更多差异点

96
00:03:45,150 --> 00:03:46,770
但是首先来看看 我们需要实际做什么

97
00:03:46,770 --> 00:03:49,790
来处理这个数据消息

