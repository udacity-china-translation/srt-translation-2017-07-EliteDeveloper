1
00:00:00,210 --> 00:00:02,084
是时候向应用添加

2
00:00:02,084 --> 00:00:03,189
媒体播放器了

3
00:00:03,189 --> 00:00:04,889
记住 媒体播放器属于

4
00:00:04,889 --> 00:00:07,769
一项服务或一个 Activity

5
00:00:07,769 --> 00:00:10,709
这取决于该应用是否需要后台播放

6
00:00:10,710 --> 00:00:12,990
那么这个小测试应用属于哪种呢？

7
00:00:12,990 --> 00:00:14,885
虽然这不是视频播放

8
00:00:14,885 --> 00:00:16,509
但用例实际上非常相似

9
00:00:16,510 --> 00:00:19,110
因为我们期望用户在听音乐时

10
00:00:19,109 --> 00:00:20,699
处于 Activity 中

11
00:00:20,699 --> 00:00:23,129
所以我们将在小测验 Activity 中实现我们的

12
00:00:23,129 --> 00:00:24,599
媒体播放器

13
00:00:24,600 --> 00:00:26,730
我在这里要预先声明一下

14
00:00:26,730 --> 00:00:28,769
尽管我们之前讨论说

15
00:00:28,769 --> 00:00:30,539
媒体播放器的最佳架构

16
00:00:30,539 --> 00:00:32,579
是去耦合的 这样播放器

17
00:00:32,579 --> 00:00:35,579
本身不会与控制它的 UI 进行通信

18
00:00:35,579 --> 00:00:38,309
而是仅与通过媒体控制器

19
00:00:38,310 --> 00:00:40,567
连接到 UI 的媒体会话通信

20
00:00:40,567 --> 00:00:42,149
但这个应用的初步实现

21
00:00:42,149 --> 00:00:43,769
将会打破此结构

22
00:00:43,770 --> 00:00:45,240
下面就是原因

23
00:00:45,240 --> 00:00:47,730
ExoPlayer 库包含一个 UI 元素

24
00:00:47,729 --> 00:00:50,219
叫做 SimpleExoPlayerView

25
00:00:50,219 --> 00:00:53,699
它大大简化了 ExoPlayer 控制器的实现

26
00:00:53,700 --> 00:00:56,520
它已经包含了用于控制 ExoPlayer 的

27
00:00:56,520 --> 00:00:58,380
所有最常用的 UI 元素--

28
00:00:58,380 --> 00:01:01,890
播放、暂停、快进、倒带、跳到下一个、

29
00:01:01,890 --> 00:01:05,400
跳到上一个-- 而最重要的是 它使用

30
00:01:05,400 --> 00:01:09,330
单个 setPlayer 方法自动绑定到 ExoPlayer

31
00:01:09,329 --> 00:01:10,289
实例

32
00:01:10,290 --> 00:01:11,550
挺厉害的 对吧？

33
00:01:11,549 --> 00:01:14,310
所以我们可以完全跳过媒体会话

34
00:01:14,310 --> 00:01:16,920
不过 也不全是

35
00:01:16,920 --> 00:01:19,500
回想一下一开始采用去耦合客户端-服务器

36
00:01:19,500 --> 00:01:21,150
结构的原因

37
00:01:21,150 --> 00:01:23,490
这是因为可能存在多个客户端

38
00:01:23,489 --> 00:01:25,920
你仍然想要此行为 因为你绝对

39
00:01:25,920 --> 00:01:27,900
希望其他客户端（如耳机中的

40
00:01:27,900 --> 00:01:31,230
媒体按钮）能够控制媒体

41
00:01:31,230 --> 00:01:34,090
所以媒体会话仍然是有必要的

42
00:01:34,090 --> 00:01:36,060
那么我们如何充分利用这两种情况

43
00:01:36,060 --> 00:01:39,750
使用简单明了的 ExoPlayer SimpleExoPlayerView

44
00:01:39,750 --> 00:01:42,810
连接 但也允许多个客户端

45
00:01:42,810 --> 00:01:44,370
控制播放？

46
00:01:44,370 --> 00:01:46,329
答案如下

47
00:01:46,329 --> 00:01:48,269
我们将 ExoPlayer 播放器视图

48
00:01:48,269 --> 00:01:51,929
二重奏视为一个原子单元 无需媒体会话

49
00:01:51,930 --> 00:01:55,290
来调解 UI 和播放器之间的通信

50
00:01:55,290 --> 00:01:58,260
然后我们将创建一个单独的媒体会话

51
00:01:58,260 --> 00:02:01,410
确保其与 ExoPlayer 状态保持同步

52
00:02:01,409 --> 00:02:04,530
这样一来 外部客户端仍然可以通过媒体会话

53
00:02:04,530 --> 00:02:07,310
来控制播放器 但在应用内时

54
00:02:07,310 --> 00:02:11,390
SimpleExoPlayerView 将直接控制 ExoPlayer

55
00:02:11,389 --> 00:02:14,059
如果你不知道如何实现这个 不用担心

56
00:02:14,060 --> 00:02:15,890
我会在后面详细解释

57
00:02:15,889 --> 00:02:18,709
现在 我们先来使用 ExoPlayer

58
00:02:18,710 --> 00:02:21,080
SimpleExoPlayerView 组合 然后

59
00:02:21,080 --> 00:02:23,950
添加媒体会话

