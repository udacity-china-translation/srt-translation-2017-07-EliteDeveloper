1
00:00:00,670 --> 00:00:02,260
你可能要问我为什么选择

2
00:00:02,258 --> 00:00:05,468
发送数据消息 而不是通知消息

3
00:00:05,469 --> 00:00:08,214
最终 我还是需要手动发送通知

4
00:00:08,214 --> 00:00:10,089
那么 这是我们之前讨论过的

5
00:00:10,089 --> 00:00:11,717
两者的区别

6
00:00:11,717 --> 00:00:13,300
实际上 对于应用在前台

7
00:00:13,300 --> 00:00:15,820
与在后台的行为 我还想

8
00:00:15,820 --> 00:00:17,460
补充几点

9
00:00:17,460 --> 00:00:19,630
对于数据消息 应用处于

10
00:00:19,629 --> 00:00:21,609
前台或后台时会触发

11
00:00:21,609 --> 00:00:23,500
onMessageReceived

12
00:00:23,500 --> 00:00:25,265
对于通知消息 我们已经

13
00:00:25,265 --> 00:00:27,098
知道当应用位于后台时

14
00:00:27,100 --> 00:00:29,320
它会显示通知

15
00:00:29,320 --> 00:00:31,088
而当应用位于前台时

16
00:00:31,088 --> 00:00:34,750
我们也设置了一项 Firebase Messaging 服务

17
00:00:34,750 --> 00:00:36,670
它会触发 onMessageReceived

18
00:00:36,670 --> 00:00:39,154
跟数据消息的方式一样

19
00:00:39,154 --> 00:00:41,320
我要指出的是 我们还有第三个选项

20
00:00:41,320 --> 00:00:44,380
你可以使用 FCM 消息 它能同时包含通知

21
00:00:44,380 --> 00:00:47,080
消息和数据消息

22
00:00:47,079 --> 00:00:50,408
此类消息不能从 Firebase 控制台发送

23
00:00:50,408 --> 00:00:53,738
它的行为跟通知消息一样

24
00:00:53,740 --> 00:00:56,710
如果应用位于后台 它会显示一条通知

25
00:00:56,710 --> 00:00:59,460
但它不会触发 onMessageReceived

26
00:00:59,460 --> 00:01:02,560
此通知还会在 intent 中包含额外信息

27
00:01:02,560 --> 00:01:04,159
而如果应用位于前台

28
00:01:04,159 --> 00:01:06,069
它会触发 onMessageReceived

29
00:01:06,069 --> 00:01:08,948
前提是你有 Firebase Messaging 服务

30
00:01:08,950 --> 00:01:11,230
所以如果你什么时候构建服务器

31
00:01:11,230 --> 00:01:14,109
并需要决定发送哪种类型的 FCM 消息时

32
00:01:14,108 --> 00:01:16,550
可以参考以下提示

33
00:01:16,552 --> 00:01:18,260
如果你需要运行一些代码

34
00:01:18,260 --> 00:01:21,010
无论应用在后台还是在前台

35
00:01:21,010 --> 00:01:23,109
都应使用数字消息

36
00:01:23,108 --> 00:01:24,608
例如 假设你想在收到新邮件

37
00:01:24,608 --> 00:01:28,039
时触发电子邮件同步

38
00:01:28,040 --> 00:01:30,687
数据消息正好满足需求

39
00:01:30,686 --> 00:01:32,769
但如果你想让系统代你

40
00:01:32,769 --> 00:01:36,009
显示通知 则使用通知消息

41
00:01:36,010 --> 00:01:38,109
注意你也可以选择运行一些代码

42
00:01:38,108 --> 00:01:40,274
但仅限应用处于前台的情况下

43
00:01:40,275 --> 00:01:41,649
适合使用通知消息的

44
00:01:41,650 --> 00:01:43,630
一个例子是

45
00:01:43,629 --> 00:01:45,929
在发布新手机游戏时

46
00:01:45,930 --> 00:01:47,740
假设 在这一年中

47
00:01:47,739 --> 00:01:50,289
你将销售玩家用于这款手游

48
00:01:50,290 --> 00:01:53,470
的筹码物品

49
00:01:53,468 --> 00:01:57,640
你将使用通知来向用户发送销售消息

50
00:01:57,640 --> 00:02:00,010
你无法确切知道营销团队

51
00:02:00,010 --> 00:02:01,840
会如何设置这些通知的版面

52
00:02:01,840 --> 00:02:04,480
或你要在其中放入什么内容

53
00:02:04,480 --> 00:02:06,070
由于使用数据消息

54
00:02:06,069 --> 00:02:08,228
要求你要能控制服务器

55
00:02:08,229 --> 00:02:10,360
并在应用中编写额外代码

56
00:02:10,360 --> 00:02:13,060
这里使用通知消息更好

57
00:02:13,060 --> 00:02:15,340
只要有正确的 Gradle 依赖关系

58
00:02:15,340 --> 00:02:17,468
这些消息就可以正常工作

59
00:02:17,468 --> 00:02:19,329
此外 你可以利用

60
00:02:19,330 --> 00:02:21,910
存储在 Firebase 中的分析功能 了解

61
00:02:21,908 --> 00:02:23,620
谁在玩游戏 将消息发送给

62
00:02:23,620 --> 00:02:26,360
特定的用户群体

63
00:02:26,360 --> 00:02:28,550
下面是最终的具体情况建议

64
00:02:28,550 --> 00:02:30,219
在 Squawker 例子中 我决定了

65
00:02:30,218 --> 00:02:31,835
使用数据消息

66
00:02:31,836 --> 00:02:33,460
这是因为我想让新的 squawk

67
00:02:33,460 --> 00:02:35,468
添加到数据库中 无论

68
00:02:35,468 --> 00:02:38,489
应用位于前台还是后台

69
00:02:38,490 --> 00:02:41,500
总而言之 传入的消息是数据消息

70
00:02:41,500 --> 00:02:43,449
还是通知消息

71
00:02:43,449 --> 00:02:46,149
由构建服务器的人决定

72
00:02:46,150 --> 00:02:48,580
在 Squawker 例子中 如我之前提到的

73
00:02:48,580 --> 00:02:51,850
我构建了服务器 并选择了数据消息

74
00:02:51,848 --> 00:02:53,709
而在 Firebase 控制台的例子中

75
00:02:53,710 --> 00:02:57,390
Google 的工程师选择发送通知消息

