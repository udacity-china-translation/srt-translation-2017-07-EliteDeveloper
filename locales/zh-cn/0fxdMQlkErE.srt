1
00:00:00,420 --> 00:00:02,085
我们最后要做的是

2
00:00:02,085 --> 00:00:03,790
添加媒体样式通知

3
00:00:03,790 --> 00:00:07,589
以验证我们的媒体会话是否正常工作

4
00:00:07,589 --> 00:00:10,529
我们创建一个名为 showNotification 的方法

5
00:00:10,529 --> 00:00:12,929
该方法将包含媒体会话状态的

6
00:00:12,929 --> 00:00:16,146
PlaybackStateCompat 对象作为参数

7
00:00:16,146 --> 00:00:17,730
此状态应该定义你是要

8
00:00:17,730 --> 00:00:21,480
使用播放操作还是暂停操作

9
00:00:21,480 --> 00:00:23,730
创建两个通知操作 -

10
00:00:23,730 --> 00:00:27,960
一个用于播放/暂停 一个用于重新开始

11
00:00:27,960 --> 00:00:30,719
对于 PendingIntent 使用 MediaButtonRecei

12
00:00:30,719 --> 00:00:34,079
ver.buildMediaButtonPendingIntent 类

13
00:00:34,079 --> 00:00:36,746
并传入相应的操作

14
00:00:36,746 --> 00:00:38,579
这将确保点击通知中的按钮

15
00:00:38,579 --> 00:00:42,079
将自动调用适当的

16
00:00:42,079 --> 00:00:44,309
媒体会话回调

17
00:00:44,310 --> 00:00:47,670
创建一个 contentPendingIntent 以能够在点击它时

18
00:00:47,670 --> 00:00:49,770
重新启动 QuizActivity

19
00:00:49,770 --> 00:00:51,660
由于清单文件中定义的此 Activity 的

20
00:00:51,659 --> 00:00:54,659
启动模式为 singleTop

21
00:00:54,659 --> 00:00:57,689
Activity 将被带到前台 而不是重启

22
00:00:57,689 --> 00:00:59,489
这样我们将不会丢失 Activity

23
00:00:59,490 --> 00:01:02,820
然后 设置媒体会话令牌

24
00:01:02,820 --> 00:01:05,587
并在 CompactView 中显示两个操作

25
00:01:05,587 --> 00:01:07,170
你可以在讲师注释中了解有关

26
00:01:07,170 --> 00:01:09,480
这些方法的更多信息

27
00:01:09,480 --> 00:01:11,910
然后 你应该使用 NotificationManager

28
00:01:11,909 --> 00:01:14,689
来发送通知

29
00:01:14,689 --> 00:01:18,259
最后 我们应该在 OnPlayerStateChanged 方法中

30
00:01:18,260 --> 00:01:20,990
调用新的 showNotification 方法

31
00:01:20,989 --> 00:01:24,769
传入 PlaybackStateCompat 对象

32
00:01:24,769 --> 00:01:27,019
记住 此方法在每次播放器的状态

33
00:01:27,019 --> 00:01:29,149
发生变化时调用 无论

34
00:01:29,150 --> 00:01:31,190
是谁做出的改变

35
00:01:31,189 --> 00:01:34,250
你也应该在 Activity 被销毁时

36
00:01:34,250 --> 00:01:36,920
在 NotificationManager 上调用 cancelAll 这样我们

37
00:01:36,920 --> 00:01:39,079
可以在想离开 Activity 时离开

38
00:01:39,079 --> 00:01:40,099
好的

39
00:01:40,099 --> 00:01:42,979
现在我们运行应用 应该会看到当音乐开始播放时

40
00:01:42,980 --> 00:01:45,520
通知会弹出来

41
00:01:45,519 --> 00:01:47,079
太完美了 对吧？

42
00:01:47,079 --> 00:01:48,909
好的 我暂停它

43
00:01:48,909 --> 00:01:49,840
糟糕

44
00:01:49,840 --> 00:01:51,670
好像哪里出问题了

45
00:01:51,670 --> 00:01:55,299
我们的通知没有任何反应

46
00:01:55,299 --> 00:01:57,730
查看我们的日志 有一行

47
00:01:57,730 --> 00:02:00,060
似乎有关

48
00:02:00,060 --> 00:02:03,570
MediaButtonReceiver-- 在给定的上下文中找不到唯一的

49
00:02:03,569 --> 00:02:06,179
MediaButtonReceiver 因此无法

50
00:02:06,180 --> 00:02:08,288
构建 pending intent

51
00:02:08,288 --> 00:02:11,160
我们还需要构建最后一个组件才能让它工作

52
00:02:11,159 --> 00:02:14,189
那就是 MediaButtonReceiver 组件

53
00:02:14,189 --> 00:02:16,560
当我们为通知操作创建

54
00:02:16,560 --> 00:02:18,974
pending intent 时 我们使用了 MediaButtonRecei

55
00:02:18,974 --> 00:02:22,439
ver.BuildMediaButtonPendingIntent 类

56
00:02:22,439 --> 00:02:24,270
来创建操作

57
00:02:24,270 --> 00:02:27,469
这基本上会创建一个带媒体按钮操作

58
00:02:27,469 --> 00:02:30,479
的广播 pending intent

59
00:02:30,479 --> 00:02:32,519
我们需要创建一个 BroadcastReceiver 类

60
00:02:32,520 --> 00:02:37,570
它带有媒体按钮 intent 操作的 intent 过滤器

61
00:02:37,569 --> 00:02:41,349
我们可以在 QuizActivity 中创建它作为一个静态

62
00:02:41,349 --> 00:02:43,219
内部类

63
00:02:43,219 --> 00:02:46,280
在 BroadcastReceiver 的 onReceive 方法中

64
00:02:46,280 --> 00:02:50,180
我们可以调用 MediaButtonReceiver.HandleIntent

65
00:02:50,180 --> 00:02:53,629
并传入 intent 和媒体会话

66
00:02:53,629 --> 00:02:56,060
这将确保 intent 正确

67
00:02:56,060 --> 00:02:59,080
路由到适当的回调

68
00:02:59,080 --> 00:02:59,800
这就好了

69
00:02:59,800 --> 00:03:02,920
我们的通知现在是一个外部客户端了

70
00:03:02,919 --> 00:03:05,079
而且你可以与通知操作进行交互了

71
00:03:05,080 --> 00:03:08,020
你可以注意到 xo 播放器 甚至是简单的 xo

72
00:03:08,020 --> 00:03:11,770
播放器视图 UI 如何更改其状态来匹配操作

73
00:03:11,770 --> 00:03:13,560
棒极了

