1
00:00:00,000 --> 00:00:01,915
（画外音）要接收和处理

2
00:00:01,915 --> 00:00:03,459
数据消息 你需要实现

3
00:00:03,459 --> 00:00:06,790
另一个叫作 FirebaseMessagingService 的服务

4
00:00:06,790 --> 00:00:08,599
这涉及三件事

5
00:00:08,599 --> 00:00:10,628
首先 你需要创建一项扩展

6
00:00:10,630 --> 00:00:12,903
FirebaseMessagingService 的服务

7
00:00:12,903 --> 00:00:14,320
然后 你需要将该服务

8
00:00:14,320 --> 00:00:18,289
添加到 MESSAGING_EVENT intent 过滤器的清单文件

9
00:00:18,289 --> 00:00:21,609
最后 你需要覆盖 onMessageReceived 方法

10
00:00:21,609 --> 00:00:25,509
它位于 FirebaseMessagingService 内

11
00:00:25,510 --> 00:00:27,850
这将在你的客户端手机上创建

12
00:00:27,850 --> 00:00:31,810
一项由传入的 FCM 数据消息触发的服务

13
00:00:31,809 --> 00:00:33,490
以及应用在后台时的

14
00:00:33,490 --> 00:00:35,269
通知消息

15
00:00:35,268 --> 00:00:37,058
这比较有用 因为它意味着应用可以

16
00:00:37,060 --> 00:00:41,777
处于后台 并被 FCM 数据消息 Ping

17
00:00:41,777 --> 00:00:43,359
然后你可以在 onMessageReceived 中

18
00:00:43,359 --> 00:00:46,210
执行所需的任何代码

19
00:00:46,210 --> 00:00:49,509
onMessageReceived 方法将 RemoteMessage 对象

20
00:00:49,509 --> 00:00:51,250
作为参数

21
00:00:51,250 --> 00:00:53,920
你可以使用此对象通过调用 getData 获取

22
00:00:53,920 --> 00:00:56,590
消息中包含的数据的映射

23
00:00:56,590 --> 00:00:59,980
GetData 将返回一个 Map 对象 包含键和值

24
00:00:59,978 --> 00:01:01,388
字符串

25
00:01:01,390 --> 00:01:05,769
例如 如果我们发送包含 squawk 数据的数据消息

26
00:01:05,769 --> 00:01:09,978
你可以将该 Map 作为输入 调用 get("author")

27
00:01:09,980 --> 00:01:12,070
来获得 squawk 的作者

28
00:01:12,069 --> 00:01:14,149
现在你知道了如何接收数据消息

29
00:01:14,150 --> 00:01:16,230
并获取它们包含的数据

30
00:01:16,230 --> 00:01:17,980
你需要搞清楚要实际

31
00:01:17,980 --> 00:01:21,070
在 onMessageReceived 中执行什么操作

32
00:01:21,069 --> 00:01:23,709
我想让你做两件事

33
00:01:23,709 --> 00:01:27,759
首先 此数据将是 squawk 消息数据

34
00:01:27,760 --> 00:01:31,300
那么我想让你在数据库中插入一条新的 squawk

35
00:01:31,299 --> 00:01:34,750
注意此数据的键与

36
00:01:34,750 --> 00:01:37,840
squawk 消息数据库中的键完全匹配

37
00:01:37,840 --> 00:01:40,659
就像是我计划好了这一切

38
00:01:40,659 --> 00:01:43,109
以让你的工作更容易

39
00:01:43,108 --> 00:01:45,488
除了向数据库中插入 squawk 外

40
00:01:45,489 --> 00:01:48,920
我还想让你向用户显示一条通知

41
00:01:48,920 --> 00:01:51,159
由于这并非一条通知消息

42
00:01:51,159 --> 00:01:53,140
它不会自动发生

43
00:01:53,140 --> 00:01:54,640
正因为如此 你实际

44
00:01:54,640 --> 00:01:57,159
需要使用 Notification.Builder 类

45
00:01:57,159 --> 00:01:59,709 
来正常构建一个通知

46
00:01:59,709 --> 00:02:02,451
希望这些信息足够你起步了

47
00:02:02,450 --> 00:02:03,908
完成后 你将

48
00:02:03,909 --> 00:02:07,989
能够向具体手机发送数据消息了

49
00:02:07,989 --> 00:02:10,780
并看它像这样出现在 Squawker 中

50
00:02:10,780 --> 00:02:13,568
以及 squawk 的通知

51
00:02:13,568 --> 00:02:15,899
好的 开始动手吧

